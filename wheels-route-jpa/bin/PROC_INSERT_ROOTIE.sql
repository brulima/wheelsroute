CREATE OR REPLACE PROCEDURE PRC_INSERE_ROOTIE(
	P_ESTADO IN WR_ESTADO.CD_ESTADO%TYPE,                      --- INFORMAÃ‡Ã”ES INSERIDAS PELO USUÃ?RIO
	P_CIDADE IN WR_CIDADE.NM_CIDADE%TYPE,                      ---
	P_BAIRRO IN WR_BAIRRO.NM_BAIRRO%TYPE,                      ---
	P_LOGRADOURO IN WR_LOGRADOURO.DS_LOGRADOURO%TYPE,          ---
  P_CEP IN WR_LOGRADOURO.NR_CEP%TYPE,                        ---
	P_NUMERO IN WR_ENDERECO.NR_ENDERECO%TYPE,                      ---
	P_TIPO_LOGRADOURO IN WR_TIPO_LOG.CD_TIPO_LOG%TYPE,  ---
	P_NOME_ROOTIE IN WR_ROOTIE.NM_NOME%TYPE,                   ---
  P_TIPO_ROOTIE IN WR_TIPO_ROOTIE.CD_TIPO_ROOTIE%TYPE,       ---
  P_LATITUDE IN WR_ENDERECO.DS_LATITUDE%TYPE,                  --- INFORMAÃ‡Ã”S DO GOOGLE MAPS
  P_LONGITUDE IN WR_ENDERECO.DS_LONGITUDE%TYPE                 ---
) IS
BEGIN
    DECLARE
       V_CIDADE WR_CIDADE.CD_CIDADE%TYPE;
       V_BAIRRO WR_BAIRRO.CD_BAIRRO%TYPE;
       V_LOGRADOURO WR_LOGRADOURO.CD_LOGRADOURO%TYPE;
       V_ENDERECO WR_ENDERECO.CD_ENDERECO%TYPE;
       V_ROOTIE WR_ROOTIE.CD_ROOTIE%TYPE;
       V_CD_GENERICO WR_ROOTIE.CD_ROOTIE%TYPE;
    BEGIN
        BEGIN
            SELECT CD_CIDADE INTO V_CIDADE FROM WR_CIDADE WHERE NM_CIDADE = P_CIDADE AND CD_ESTADO = P_ESTADO;
        EXCEPTION
            WHEN OTHERS THEN
                V_CD_GENERICO := SQ_WR_CIDADE.NEXTVAL;
                INSERT INTO WR_CIDADE (CD_CIDADE, NM_CIDADE, CD_ESTADO) VALUES (V_CD_GENERICO, P_CIDADE, P_ESTADO);
                SELECT CD_CIDADE INTO V_CIDADE FROM WR_CIDADE WHERE CD_CIDADE = V_CD_GENERICO;
        END;
        BEGIN
            SELECT CD_BAIRRO INTO V_BAIRRO FROM WR_BAIRRO WHERE NM_BAIRRO = P_BAIRRO AND CD_CIDADE = V_CIDADE;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                V_CD_GENERICO := SQ_WR_BAIRRO.NEXTVAL;
                INSERT INTO WR_BAIRRO (CD_BAIRRO, NM_BAIRRO, CD_CIDADE) VALUES (V_CD_GENERICO, P_BAIRRO, V_CIDADE);
                SELECT CD_BAIRRO INTO V_BAIRRO FROM WR_BAIRRO WHERE CD_BAIRRO = V_CD_GENERICO;
        END;
        BEGIN
            SELECT CD_LOGRADOURO INTO V_LOGRADOURO FROM WR_LOGRADOURO WHERE DS_LOGRADOURO = P_LOGRADOURO AND CD_BAIRRO = V_BAIRRO;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                V_CD_GENERICO := SQ_WR_LOGRADOURO.NEXTVAL;
                INSERT INTO WR_LOGRADOURO (CD_LOGRADOURO, NR_CEP, DS_LOGRADOURO, CD_BAIRRO, CD_TIPO_LOG) VALUES (V_CD_GENERICO, P_CEP, P_LOGRADOURO, V_BAIRRO, P_TIPO_LOGRADOURO);
                SELECT CD_LOGRADOURO INTO V_LOGRADOURO FROM WR_LOGRADOURO WHERE CD_LOGRADOURO = V_CD_GENERICO;
        END;
        BEGIN
            SELECT CD_ENDERECO INTO V_ENDERECO FROM WR_ENDERECO WHERE NR_ENDERECO = P_NUMERO AND CD_LOGRADOURO = V_LOGRADOURO;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                V_CD_GENERICO := SQ_WR_ENDERECO.NEXTVAL;
                INSERT INTO WR_ENDERECO (CD_ENDERECO, NR_ENDERECO, DS_LATITUDE, DS_LONGITUDE, CD_LOGRADOURO) VALUES (V_CD_GENERICO, P_NUMERO, P_LATITUDE, P_LONGITUDE, V_LOGRADOURO);
                SELECT CD_ENDERECO INTO V_ENDERECO FROM WR_ENDERECO WHERE CD_ENDERECO = V_CD_GENERICO;
        END;
        BEGIN
            SELECT CD_ROOTIE INTO V_ROOTIE FROM WR_ROOTIE WHERE NM_NOME = P_NOME_ROOTIE AND CD_ENDERECO = V_ENDERECO;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                V_CD_GENERICO := SQ_WR_ROOTIE.NEXTVAL;
                INSERT INTO WR_ROOTIE (CD_ROOTIE, NM_NOME, CD_TIPO_ROOTIE, CD_ENDERECO) VALUES (V_CD_GENERICO, P_NOME_ROOTIE, P_TIPO_ROOTIE, V_ENDERECO);
                SELECT CD_ROOTIE INTO V_ROOTIE FROM WR_ROOTIE WHERE CD_ROOTIE = V_CD_GENERICO;
        END;
        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
        RAISE_APPLICATION_ERROR( -20003, 'ERRO CRÃ?TICO ! INSERE ROOTIE ' || SQLERRM );
    END;
END PRC_INSERE_ROOTIE;

BEGIN PRC_INSERE_ROOTIE(
  25,
	'São Paulo',
	'Cambuci',
	'Lins de Vasconcelos',
  05145000,
	1222,
	1,
	'FIAP',
  1,
  '12154',
  '564645'
); END;